摘自《深入理解Java虚拟机》第二版

# 1 HotSpot虚拟机对象探秘

## 1.1 对象的创建

###1.1.1 类加载检查

​	虚拟机遇到一条new指令时，首相去检查这个指令的参数是否能在**常量池**中定位到一个类的符号引用，并且检查这个符号引用代表的类是否被加载、解析和初始化过。如果没有则必须先进行相应类的类加载过程。

###1.1.2 新生对象分配内存（分配方法：指针碰撞、空闲列表）

​	在类加载检查通过之后，则进行新生对象的内存分配。

​	 **对象所需的内存大小在类加载完成后便完全确定**，为对象分配内存空间等同于把一块确定大小的内存从Java堆中划分出来。

​	假设Java堆内存是**绝对规整**的，所有用过的内存都放在一边，空闲的内存放在另一边，中间放着一个指针作为分界点的指示器（类似车辆的油表），所分配的内存就仅仅是把指针向空闲空间挪动一段与对象大小相等的距离（车辆加油的过程），这种分配方式称为**“指针碰撞”**（Bump the Pointer）。

​	如果Java对内存**不是规整**的，已使用的内存和空闲的内存相互交错，就没法简单的进行指针碰撞了，虚拟机就必须维护一个列表，记录哪些内存块是可用的，在内存分配的时候从列表中找到一块足够大的空间划分给对象实例，并更新列表上的记录，这种分配方式称为**“空闲列表”**（Free List）。

​	选择哪种分配方式是由Java堆是否规整决定的，而**Java堆是否规整由所采用的垃圾收集器是否带有压缩整理功能决定**。

### 1.1.3 并发对象内存分配



